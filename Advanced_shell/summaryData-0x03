#!/bin/bash

# Output CSV file
REPORT_FILE="pokemon_report.csv"

# JSON source directory
DATA_DIR="pokemon_data"

# Ensure directory exists
if [ ! -d "$DATA_DIR" ]; then
  echo "Directory $DATA_DIR not found."
  exit 1
fi

# Start CSV file with header
echo "Name,Height (m),Weight (kg)" > "$REPORT_FILE"

# Loop over JSON files and extract data
for file in "$DATA_DIR"/*.json; do
  # Use jq to extract values
  name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')
  height_dm=$(jq -r '.height' "$file")
  weight_hg=$(jq -r '.weight' "$file")

  # Convert to meters and kilograms
  height_m=$(awk -v h="$height_dm" 'BEGIN { printf "%.2f", h / 10 }')
  weight_kg=$(awk -v w="$weight_hg" 'BEGIN { printf "%.2f", w / 10 }')

  # Append to CSV
  echo "$name,$height_m,$weight_kg" >> "$REPORT_FILE"
done

# Show confirmation
echo "CSV Report generated at: $REPORT_FILE"
echo ""

# Print the report
cat "$REPORT_FILE"

# Calculate averages using awk
awk -F, 'NR>1 {
  height += $2;
  weight += $3;
  count++
}
END {
  avg_height = height / count;
  avg_weight = weight / count;
  printf "\nAverage Height: %.2f m\n", avg_height;
  printf "Average Weight: %.2f kg\n", avg_weight;
}' "$REPORT_FILE"
